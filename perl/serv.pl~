#!/usr/bin/perl

use strict;
use warnings;
use IO::Socket::INET;


while (1)
{
function();
}
sub function {
my $socket;
my  $clientsocket;
my $serverdata;
my $clientdata;

$socket = new IO::Socket::INET (
    LocalHost => '127.0.0.1',
    LocalPort => '0158',
    Proto => 'tcp',
    Listen => 1,
    Reuse => 1
) or die "Oops: $! \n";
print "Waiting for the Client.\n";


$clientsocket = $socket->accept();


# Write some data to the client  
$serverdata = "PID pere $$:)\n";
print $clientsocket "$serverdata \n";

# read the data from the client
my $Options = <$clientsocket>;
print $Options;

#system("tshark $clientdata > /home/czhn4415/Desktop/FinalyMyResult");

my $datestring = localtime();
$datestring =~ tr/ //ds;
my $file = "capture" . $datestring ;
print $datestring;

system("tshark $Options -w /opt/lampp/htdocs/Stage2/resultats/$file");
$socket->close(); 
system("chmod 777 /opt/lampp/htdocs/Stage2/resultats/$file");
system("echo $file > /opt/lampp/htdocs/Stage2/resultats/file.txt");
system("cp /opt/lampp/htdocs/Stage2/resultats/$file /home/czhn4415/Desktop/NetProTester/Captures");

}


