#!/usr/bin/perl -w
use strict;
use warnings;
use 5.012;
use CGI;
use URI::Escape;
#use Capture::Tiny ':all';
use Carp; 
my $cgi = new CGI;
use utf8; 
use HTML::Entities;
#use Capture::Tiny 'capture_merged';
print "Content-Type: text/html \n\n";  
  use CGI::Carp qw(fatalsToBrowser); 
use IO::Socket::INET;

#Create our object and initialises the CGI creates a layer of abstraction transmission / reception to contact our customer package Ajax;       

# Ajax Class  

use constant false => 0;
use constant true  => 1;

my $param = $cgi->{param};
my $lab0 = $cgi->param('lab0');
my $lab = $cgi->param('lab');
my $OptionT = $cgi->param('OptionT');
my $OptionTText = $cgi->param('OptionTText');
my $OptionP = $cgi->param('OptionP');
my $OptionPText = $cgi->param('OptionPText');
my $Option4P = $cgi->param('Option4P');
my $Option6P = $cgi->param('Option6P');
my $value;
my $Options ;

$Options = "dig";

$Options = $Options . ' @'."$lab0";
$Options = $Options . " $lab";



if ($OptionT eq 'true') 
{
$Options = $Options . " -t $OptionTText";
}

if ($OptionP eq 'true') 
{
$Options = $Options . " -p $OptionPText";
}

if ($Option4P eq 'true') 
{
$Options = $Options . " -4";
}

if ($Option6P eq 'true') 
{
$Options = $Options . " -6";
}


my $filename = 'pid.txt';
#open(my $fh, '>', $filename) or die "Could not open file '$filename' $!";
#print $fh $$;
#print $$;
my $socket;
my $serverdata;
my $clientdata;

$socket = new IO::Socket::INET (
  PeerHost => '127.0.0.1',
  PeerPort => '0160',
  Proto => 'tcp',
) or die "$!\n";


my $var = "";



# Send some message to server.
print $socket "$Options";
shutdown($socket, 1);



$var = <$socket>; 
       



$socket->close();
my $filename = '/opt/lampp/htdocs/Stage/resultats/tmp';
open(my $fh, '<:encoding(UTF-8)', $filename)
  or die "Could not open file '$filename' $!";
 
while (my $row = <$fh>) {
  chomp $row;
  print "$row\n";
}

$cgi->header('text/plain;charset=UTF-8');

